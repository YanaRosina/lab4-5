<html lang="en">
<head>
 <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
 <meta name="viewport" content="width=device-width, initial-scale=1"/>
 <title>LAB 4 and 5</title>
 <link href="style.css" type="text/css" rel="stylesheet"/>
</head>
<body >

<div class="navbar">
Лабораторная работа № 4 и 5.
</div>
<div class="center">
  <div class="image">
    <canvas class="mypic"   width="640" height="480" id="q2"></canvas>
  </div>
    <input type="button" value="GENERATE" class="click" onclick="GENERATE()">
    <input type="button" value="DOWNLOAD" class="click" onclick="DOWNLOAD()">
</div>

</body>
<script type="text/javascript">
function DOWNLOAD()
{
  alert('Еще нет, но скоро будет');
}
function GENERATE()
{
  getimg();

}
function getimg(){
  var XHR = ("onload" in new XMLHttpRequest()) ? XMLHttpRequest : XDomainRequest;
  var xhr = new XHR();
  xhr.open('GET', 'https://loremflickr.com/640/480', true);
  xhr.onload = function()
   {
     var canvas = document.getElementById('q2'),
     context = canvas.getContext('2d');
     image = new Image();
     image.src = this.responseURL;
     image.onload = function()
     {
       context.drawImage(image, 0, 0);
       getext();
     }
   }
  xhr.onerror = function() {
  alert( 'No connection' );
}
xhr.send();
}
function getext()
{
  const QUOTE_URL = "https://andruxnet-random-famous-quotes.p.mashape.com";
  const QUOTE_API_KEY = "CdbBmWOrBfmshc7t9INffynYmXwNp1JFGbpjsny0dUKurJRhrP";
    var xhr = new XMLHttpRequest();
    xhr.open("GET", QUOTE_URL);
    xhr.setRequestHeader("X-Mashape-Key", QUOTE_API_KEY);
    xhr.onload = function ()
    {
        var quote = JSON.parse(this.responseText);
        var canvas = document.getElementById("q2");
        var context = canvas.getContext("2d");
        var maxWidth = 400;
        var lineHeight = 25;
        var marginLeft = 20;
        var marginTop = 40;
        context.font = "16pt Calibri";
        context.fillStyle = "#fff";
        wrapText(context, quote.quote, marginLeft, marginTop, maxWidth, lineHeight);
    }
    xhr.send();
}


function wrapText(context, text, marginLeft, marginTop, maxWidth, lineHeight)
    {
        var words = text.split(" ");
        var countWords = words.length;
        var line = "";
        for (var n = 0; n < countWords; n++) {
            var testLine = line + words[n] + " ";
            var testWidth = context.measureText(testLine).width;
            if (testWidth > maxWidth) {
                context.fillText(line, marginLeft, marginTop);
                line = words[n] + " ";
                marginTop += lineHeight;
            }
            else {
                line = testLine;
            }
        }
        context.fillText(line, marginLeft, marginTop);
    }






</script>
</html>
